### [OSI七层模型](https://www.cnblogs.com/qishui/p/5428938.html)

OSI（Open system interconnection / reference model）：开发式系统互联模型，它是世界上第一个试图在世界范围内规范网络标准的框架。OSI模型定义了网络互联的七层框架，从上到下依次为：

![clipboard](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2020/11/20201122192340219.png)

##### 应用层（application layer）

OSI模型中最靠近用户的一层，是为计算机用户提供应用接口，也为用户直接提供各种网络服务。我们常见应用层的网络服务协议有：HTTP，HTTPS，FTP，POP3、SMTP等。该层用来表达业务问题，只关心业务逻辑，不关心数据的传输，为应用程序提供服务。

##### 表示层（presentation layer）

提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。其负责__协商__用于传输的数据格式，并转换数据格式与数据加密

> - 发送数据时：表示层会将应用层数据转换成传输层数据
> - 接收数据时：表示层会将接收到的数据转换成应用层数据

##### 会话层（session layer）

负责管理两个联网实体键的连接，其功能为：建立、管理、中止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。

##### 传输层（transport layer）

建立了主机端到端的连接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向上层屏蔽了下层数据通信的细节，使上层用户看到的只是两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。通常说的TCP、UDP就是在这一层，端口号既是这里的端。它具备以下能力：

> - 数据分割重组：将数据拆分后按顺序重组
> - 数据纠错：在数据传输过程中出现问题后采取方式进行纠正
> - 管理连接：处理数据的频繁交换
> - 流量控制：控制传输数据的速率
> - 端口寻址：标明参与传输的实体的端口号

##### 网络层（network layer）

通过IP寻址来建立两个节点之间的连接，为源端的传输层送来的分组，通过___路由算法___选择合适的路由和交换节点，正确无误的按照地址传送给目的端的传输层。这一层就是我们经常说的IP协议层。

##### 数据链路层（data link layer）

将比特组合成字节，再将字节组合成帧，使用链路层地址（以太网使用MAC地址）来访问介质，并进行差错检测。    确保两个临近的设备间数据的传输，并隐藏底层实现。数据链路层又分为两个子层：

>   -   LLC：逻辑链路控制子层：定义了一些字段使上次协议能共享数据链路层
>   -   MAC：媒体访问控制子层：处理CSMA/CD算法、数据出错校验、成帧等

##### 物理层（physical layer）

实现最终信号的传输，通过物理介质传世比特流。封装和隐藏具体的传输手段，并提供稳定的传输接口，如：电缆、光纤、蓝牙



### [TCP/IP协议5层模型](https://www.cnblogs.com/ellisonzhang/p/10403311.html)

TCP/IP五层协议和OSI七层协议对应的关系如下，每一层都工作着不同的设备，比如常用的交换机就工作在数据链路层，一般的路由器就工作在网络层。用户感知到的只是最上一层应用层，自上而下每层都依赖于下一层，每层都运行特定的协议，越往上越靠近用户，越往下约靠近硬件。

![image-20201123114104123](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2020/11/202011231141044.png)

##### 物理层

主要是基于电器特性发送高低电压（电信号），高电压对应数字1，低电压对应数字0

##### 数据链路层

由于单纯的电信号0-1没有任何意义，所以必须规定电信号多少位一组，每组什么含义。即数据链路层定义了电信号的岑组方式。

###### 以太网协议（Ethernet）

早期的时候各个局域网都有自己的分组方式，后来形成了统一的标准，即以太网协议，Ethernet规定：

1.  一组电信号构成一个数据包，叫做帧
2.  每一数据帧由报头（head）和数据（data）两部分组成

![image-20201123115353111](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2020/11/2020112311535353.png)

###### MAC地址

Ethernet规定接入Internet的设备都必须具备网卡，发送端和接收端的地址就是指网卡的地址，即MAC地址。每块网卡出场时都被烧制上了一个世界唯一的MAC地址，长度为48bit。通常由12位16禁止组成，前六位是厂商编号，后六位是流水号。

###### 广播

有了MAC地址，同一网络内的两台主机就可以通信了，一台主机通过ARP协议获取另一台主机的MAC地址，Ethernet采用最原始的方式：___广播___的方式来进行通信。

![image-20201123115906574](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2020/11/202011231159066.png)

##### 网络层

有了Ethernet、MAC地址、广播的发送方式，世界上的计算机就可以彼此通信了，问题是世界范围的互联网是由一个个彼此隔离的小的局域网组成的，那么如果所有的都采用以太网的广播方式，那么一台机器发送的报文全世界都会受到，这就不仅仅是效率低的问题了，而是一场灾难。

因此必须找出一种方法来区分那些计算机属于同一广播域，那些不是：

-   如果是：就采用广播的方式发送
-   如果不是，则采用路由的方式（向不同的广播域/子网分发资源包）

所以网络层就是为了引入一套新的地址用来区分不同的广播域/子网，这套心底地址就是网络地址。

###### [IP协议](./003 IP协议.md)

###### ARP协议

由于计算机的通信方式为广播的方式，所有上层的包到最后都要封装上以太网的头，然后通过以太网协议发送，在谈及以太网的时候我们了解到：通信是基于MAC的广播方式发送实现，计算机在发包时，获取自身的MAC是容易的，但是如何获取目标主机的MAC，就需要通过ARP协议。

ARP协议的功能：广播的方式发送数据报，获取目标主机的MAC地址

协议工作的方式：每台主机IP都是已知的

例：主机172.16.10.10/24访问172.16.10.11/24

1.  首先通过IP地址和子网掩码区分出自己所处的子网

    | 场景     | 数据包地址              |
    | -------- | ----------------------- |
    | 同一子网 | 目标主机MAC，目标主机IP |
    | 不同子网 | 网关MAC，目标主机IP     |

2.  分析主机172.16.10.10/24与172.16.10.11/24处于同一网络（如果不是同一网络，那么下表中的目标IP为172.16.10.1，通过ARP协议获取的是网关的MAC）后数据报如下

    |            | 源MAC     | 目标MAC           | 源IP            | 目标IP          | 数据部分 |
    | ---------- | --------- | ----------------- | --------------- | --------------- | -------- |
    | 发送端主机 | 发送端MAC | FF:FF:FF:FF:FF:FF | 172.16.10.10/24 | 172.16.10.11/24 | data     |

3.  这个包会以广播的方式发送在发送端所处的子网内传输，所有主机接收后打开包，发现目标IP为自己的，就响应，返回自己的MAC

    ```shell
    /> arp -a
    
    接口: 172.16.0.164 --- 0x6
      Internet 地址         物理地址              类型
      172.16.0.1            70-57-bf-fd-09-aa     动态
      172.16.0.16           94-87-e0-67-36-44     动态
      172.16.0.17           c8-d9-d2-99-6a-1f     动态
      172.16.0.24           3c-f0-11-20-2e-16     动态
      172.16.0.26           84-ad-8d-87-de-88     动态
      172.16.0.27           80-0c-67-a7-34-cf     动态
      172.16.0.32           d8-f2-ca-1d-3b-cf     动态
      172.16.0.42           d0-c6-37-a6-e8-48     动态
      172.16.0.46           60-57-18-e0-90-d9     动态
      172.16.0.57           ae-e2-f5-33-e8-58     动态
      172.16.0.76           02-11-32-26-e3-cb     动态
      172.16.0.135          a4-44-d1-40-c4-2f     动态
      172.16.0.177          3c-6a-a7-6d-70-9a     动态
      172.16.0.200          00-11-32-b0-20-e7     动态
      172.16.0.240          04-d7-a5-17-22-91     动态
      172.16.0.241          34-6b-5b-0c-62-4f     动态
      172.16.0.250          c4-65-16-40-bd-e7     动态
      172.16.0.255          ff-ff-ff-ff-ff-ff     静态
      224.0.0.22            01-00-5e-00-00-16     静态
      224.0.0.251           01-00-5e-00-00-fb     静态
      224.0.0.252           01-00-5e-00-00-fc     静态
      230.230.230.230       01-00-5e-66-e6-e6     静态
      239.255.255.250       01-00-5e-7f-ff-fa     静态
      255.255.255.255       ff-ff-ff-ff-ff-ff     静态
    
    接口: 192.168.56.1 --- 0x16
      Internet 地址         物理地址              类型
      192.168.56.255        ff-ff-ff-ff-ff-ff     静态
      224.0.0.22            01-00-5e-00-00-16     静态
      224.0.0.251           01-00-5e-00-00-fb     静态
      224.0.0.252           01-00-5e-00-00-fc     静态
      239.255.255.250       01-00-5e-7f-ff-fa     静态
    ```

###### ICMP协议（网络控制协议）

由于IP协议并不是一个可靠的协议，它不保证数据被送达，那么自然保证数据送达的工作应该由其他的模块来完成，其中一个重要的模块就是ICMP协议。

当传送IP数据包发送错误：比如主机不可达、路由器不可达等，ICMP协议将会将错误信息封包，然后传送回给主机，给主机一个处理错误的机会。

我们一般主要用ICMP来检测网络是否通畅，基于ICMP协议的工具主要有：ping、traceroute

___ping___

ping这个单词源自声纳定位，而这个程序的作用也确实如此，它利用ICMP协议包来侦测另一个主机是否可达。

原理是用类型码为0的ICMP发请 求，受到请求的主机则用类型码为8的ICMP回应。

__ping程序来计算间隔时间，并计算有多少个包被送达。用户就可以判断网络大致的情况。我们可以看到， ping给出来了传送的时间和TTL的数据。__

```SHELL
/> ping www.baidu.com

正在 Ping www.baidu.com [36.152.44.95] 具有 32 字节的数据:
来自 36.152.44.95 的回复: 字节=32 时间=25ms TTL=56
来自 36.152.44.95 的回复: 字节=32 时间=9ms TTL=56
来自 36.152.44.95 的回复: 字节=32 时间=10ms TTL=56
来自 36.152.44.95 的回复: 字节=32 时间=10ms TTL=56

36.152.44.95 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 9ms，最长 = 25ms，平均 = 13ms
```

___traceroute___

用来查看从当前主机到某地址一共经过多少跳路由

-   window 用命令：tracert
-   linux命令：tracerout

```shell
/> tracert www.baidu.com

通过最多 30 个跃点跟踪
到 www.baidu.com [36.152.44.96] 的路由:

  1    <1 毫秒   <1 毫秒    2 ms  172.16.0.1
  2     3 ms     3 ms     2 ms  111.0.120.254
  3     2 ms     3 ms     3 ms  221.131.194.241
  4    10 ms     4 ms     4 ms  221.183.64.49
  5    20 ms    19 ms    17 ms  221.183.42.61
  6    19 ms    20 ms     9 ms  221.183.59.50
  7     8 ms    24 ms    15 ms  134.23.207.183.static.js.chinamobile.com [183.207.23.134]
  8     *        *        *     请求超时。
  9    10 ms    10 ms    10 ms  36.152.44.96

跟踪完成。
```

##### 传输层

__网络层的IP帮我们区分子网，以太网层的MAC帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，迅雷等多个应用程序，__

那么我们通过IP和MAC找到了一台特定的主机，如何标识这台主机上的应用程序呢？答案就是___端口___，端口即应用程序与网卡关联的编号。

传输层功能：建立端口到端口的通信，端口的范围：`0~65535`，其中`0~1023`为系统占用的端口，传输层协议常见的有两种：[TCP协议](./002 TCP协议.md) & [UDP协议](./004 UDP协议.md)

![image-20201123144205231](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2020/11/202011231442055.png)





__参考：__

https://www.cnblogs.com/qishui/p/5428938.html

https://www.cnblogs.com/ellisonzhang/p/10403311.html