### JVM相关配置

| 配置                                         | 说明                                                         |
| -------------------------------------------- | ------------------------------------------------------------ |
| -agentlib:ipharmacare_hook                   | 公司指定文件：解析密钥需用到                                 |
| -Xms2g                                       | jvm堆的最小值                                                |
| -Xmx2g                                       | jvm堆的最大值                                                |
| -Xmn1g                                       | 新生代内存区域的大小                                         |
| -XX:MetaspaceSize=256m                       | 元空间初始空间大小                                           |
| -XX:MaxMetaspaceSize=512m                    | 元空间 最大空间，默认是没有限制的。                          |
| -XX:MaxNewSize                               | 新生代最大值                                                 |
| -XX:MaxPermSize                              | 永久代最大值                                                 |
| -XX:SurvivorRatio=8                          | 新生代内存区域中Eden和Survivor的比例                         |
| -XX:+PrintGCTimeStamps                       | 输出GC的时间戳（以基准时间的形式）                           |
| -XX:+PrintGCDateStamps                       | 输出GC的时间戳（以日期的形式，如 2013-05-04T21:53:59.234+0800） |
| -XX:+PrintGCDetails                          | 打印出GC的详细信息                                           |
| -verbose:gc                                  | 开启gc日志                                                   |
| -Xloggc:/mnt/yyspace/logs/gc/system_gc.log   | gc日志的存放位置                                             |
| -XX:NumberOfGCLogFiles=3                     | 设置滚动日志文件个数为                                       |
| -XX:GCLogFileSize=2048K                      | 设置滚动日志文件大小为                                       |
| -XX:+PrintStringTableStatistics              | 在JVM进程退出时，打印出StringTable的统计信息到标准日志输出目录中 |
| -XX:+HeapDumpOnOutOfMemoryError              | 可以让JVM在出现内存溢出时候Dump出当前的内存转储快照          |
| -XX:HeapDumpPath=/mnt/yyspace/logs/heap/sys/ | 保存快照的地址                                               |
| -Dcom.sun.management.jmxremote               | 以下参数为开启远程监控                                       |
| -Djava.rmi.server.hostname=10.1.1.186        | 主机ip                                                       |
| -Dcom.sun.management.jmxremote.port=8999     | 端口                                                         |

![image-20210602112958696](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2021/06/2021060211301818.png)

### 垃圾回收器配置

| 参数                   | 描述                                                         |
| ---------------------- | ------------------------------------------------------------ |
| UseSerialGC            | 使用 Serial + SerialOld 组合进行垃圾回收                     |
| UseParNewGC            | 使用 ParNew + SerialOld 组合进行垃圾回收                     |
| UseConcMarkSweepGC     | 使用 ParNew + CMS + SerialOld 组合进行垃圾回收，SerialOld作为CMS的后备 |
| UseParallelGC          | 使用 PS + SerialOld 组合进行垃圾回收                         |
| UseParallelOldGC       | 使用 PS + PO 组合进行垃圾回收                                |
| SurvivalRatio          | 新生代中 eden 与 survival 区的容量比值，默认为 8:1:1         |
| PretenureSizeThreshold | 直接晋升到老年代的对象的大小，大于该阈值的对象，会直接晋升到老年代 |
| MaxTenuringThreshold   | 直接晋升到老年代的年龄，年龄超过该阈值的对象，会直接晋升到老年代 |
| UseAdaptiveSizePolicy  | 动态调整java堆中各个区域的大小以及进入老年代的年龄           |
| ParallelGCThreads      | 设置并行GC时进行内存回收的线程数                             |

### [GC的分类](../xmind/垃圾回收.xmind)

### GC日志解读

>   ![image-20210602114353452](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2021/06/2021060211435353.png)
>
>   其中：
>
>   -   CommandLine flags：  GC & JVM 的相关参数配置
>   -   2021-05-27T16:58:39.489+0800: 3.083：具体发生GC的时间点，这个数字的含义是从Java虚拟机启动以来经过的秒数
>   -   GC：这次垃圾收集的停顿类型，而不是用来区分新生代GC还是老年代GC的。如果有“Full”，说明这次GC是发生了Stop-The-World的。
>   -   ParNew：GC发生的区域，这里显示的区域名称与使用的GC收集是密切相关的
>   -   873856K->9907K(961216K)：GC前该内存区域已使用容量-＞GC后该内存区域已使用容量（该内存区域总容量）
>   -   873856K->9907K(2009792K)：GC前Java堆已使用容量-＞GC后Java堆已使用容量（Java堆总容量）
>   -   0.0285991 secs：表示该内存区域GC所占用的时间，单位是秒
>   -   Times: user=0.05 sys=0.00, real=0.03 secs：这里面的user、sys和real与Linux的time命令所输出的时间含义一致，分别代表用户态消耗的CPU时间、内核态消耗的CPU事件和操作从开始到结束所经过的墙钟时间（Wall Clock Time）
>       -   real：指的是操作从开始到结束所经过的墙钟时间（WallClock Time）
>       -   user：指的是用户态消耗的CPU时间；
>       -   sys：指的是内核态消耗的CPU时间。

上面的这些参数，能够帮我们查看分析GC的垃圾收集情况。但是如果GC日志很多很多，成千上万行。就算你一目十行，看完了，脑子也是一片空白。所以我们可以借助一些功能来帮助我们分析，这里推荐一个[gceasy](http://gceasy.io/),可以上传gc文件，然后他会利用可视化的界面来展现GC情况。具体下图所示

![image-20210602115158565](https://typroa12138.oss-cn-hangzhou.aliyuncs.com/image/2021/06/2021060211515858.png)

上图我们可以看到年轻代，老年代，以及永久代的内存分配，和最大使用情况。